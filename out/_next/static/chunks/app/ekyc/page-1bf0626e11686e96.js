(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[74],{3711:function(e,t,s){"use strict";s.d(t,{Z:function(){return i}});var a=s(5531);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let i=(0,a.Z)("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]])},8538:function(e,t,s){Promise.resolve().then(s.bind(s,2798))},2798:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return b}});var a=s(7437),i=s(220),r=s(2265),l=s(4033),n=s(3023),c=s(6951),o=s(1121),d=s(4530),u=s(9806),m=s(6141),h=s(3711);function x(e){let{onStatusChange:t,showActions:s=!0}=e,[i,l]=(0,r.useState)("PENDING"),[o,x]=(0,r.useState)(!1),{sdkReady:f,sdk:p}=(0,c.e)();(0,r.useEffect)(()=>{let e=localStorage.getItem("ekyc_status")||"PENDING";l(e)},[]);let y=async()=>{if(f){x(!0);try{let t=localStorage.getItem("user_id");if(t){let s=await p.ekyc.generateWebSdkLink(t);if(s.success||s.data){var e;let t=(null===(e=s.data)||void 0===e?void 0:e.web_sdk_url)||s.web_sdk_url;t&&window.open(t,"_blank")}}}catch(e){console.error("Failed to start eKYC verification:",e)}finally{x(!1)}}},b=(()=>{switch(i){case"APPROVED":return{icon:d.Z,label:"Verified",description:"Your identity has been successfully verified",color:"text-secondary",bgColor:"bg-secondary/10",borderColor:"border-secondary/20",actionLabel:"Continue to Dashboard"};case"REJECTED":return{icon:u.Z,label:"Rejected",description:"Identity verification failed. Please try again.",color:"text-destructive",bgColor:"bg-destructive/10",borderColor:"border-destructive/20",actionLabel:"Retry Verification"};default:return{icon:m.Z,label:"Pending",description:"Complete identity verification to access all features.",color:"text-warning",bgColor:"bg-warning/10",borderColor:"border-warning/20",actionLabel:"Start Verification"}}})(),g=b.icon;return(0,a.jsx)("div",{className:"p-4 rounded-xl border ".concat(b.bgColor," ").concat(b.borderColor),children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(g,{className:"h-5 w-5 ".concat(b.color)}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-semibold",children:"eKYC Status"}),(0,a.jsx)("p",{className:"text-sm font-medium ".concat(b.color),children:b.label}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:b.description})]})]}),s&&"APPROVED"!==i&&(0,a.jsxs)(n.z,{size:"sm",onClick:y,disabled:o||!f,className:"whitespace-nowrap",children:[b.actionLabel,(0,a.jsx)(h.Z,{className:"h-3 w-3 ml-1"})]})]})})}var f=s(8063);function p(){let[e,t]=(0,r.useState)("PENDING"),[s,u]=(0,r.useState)(!1),[m,h]=(0,r.useState)(!1),[p,y]=(0,r.useState)(!1),[b,g]=(0,r.useState)(""),[v,w]=(0,r.useState)({reviewStatus:null,reviewAnswer:null}),{sdkReady:j,sdk:N,isAuthenticated:S,user:k}=(0,c.e)(),{updateEkycStatus:P}=(0,i.useAuth)(),D=(0,l.useRouter)();(0,r.useEffect)(()=>{E()},[j,S]),(0,r.useEffect)(()=>{"APPROVED"===e&&setTimeout(()=>{D.push("/dashboard")},1e3)},[e,D]);let E=async()=>{if(!j||!S||!(null==k?void 0:k.user_id))return;try{let e=await N.ekyc.getEkycStatus(k.user_id);if((null==e?void 0:e.ekyc_status)==="APPROVED"){t("APPROVED"),localStorage.setItem("ekyc_status","APPROVED"),P("APPROVED");return}}catch(e){console.warn("Failed to fetch eKYC status:",e)}let e=localStorage.getItem("ekyc_status")||"PENDING";t(e)},C=async()=>{let e=localStorage.getItem("sumsub_applicant_id"),s=localStorage.getItem("user_id");if(!e||!s||!v.reviewStatus||!v.reviewAnswer){g("Unable to sync. Missing verification data. Please complete the verification process.");return}try{u(!0);let a={applicantId:e,user_id:s,reviewStatus:v.reviewStatus,reviewAnswer:v.reviewAnswer},i=await N.ekyc.syncSumsubStatus(a);console.log("Manual Sync Result:",i),t("APPROVED"),localStorage.setItem("ekyc_status","APPROVED"),P("APPROVED"),setTimeout(()=>{D.push("/dashboard")},1500)}catch(e){console.error("Manual sync error:",e),g("Manual sync failed. Please contact support or try again.")}finally{u(!1)}};return((0,r.useEffect)(()=>{let t;let s=async()=>{let s=localStorage.getItem("user_id");if(s&&j&&"APPROVED"!==e)try{console.log("\uD83D\uDE80 Initializing Sumsub SDK...");let e=await N.ekyc.generateSumsubToken(),s=e.token;if(!s)throw Error("No access token received");let a=(null==k?void 0:k.email)||localStorage.getItem("email")||"demo@brdz.link",i=localStorage.getItem("phone")||"+62800000000";(t=document.createElement("script")).src="https://static.sumsub.com/idensic/static/sns-websdk-builder.js",t.async=!0,t.onload=()=>{console.log("✅ Sumsub SDK script loaded");let e=window.snsWebSdk.init(s,async()=>{try{let e=await N.ekyc.generateSumsubToken();return e.token}catch(e){throw console.error("Error refreshing Sumsub token:",e),e}}).withConf({lang:"en",email:a,phone:i}).withOptions({addViewportTag:!1,adaptIframeHeight:!0}).on("idCheck.onApplicantLoaded",e=>{e.applicantId&&(localStorage.setItem("sumsub_applicant_id",e.applicantId),console.log("\uD83D\uDCBE Applicant ID loaded:",e.applicantId))}).on("idCheck.onApplicantStatusChanged",e=>{var t;console.log("\uD83D\uDD04 Sumsub Status Changed:",e),w({reviewStatus:e.reviewStatus||null,reviewAnswer:(null===(t=e.reviewResult)||void 0===t?void 0:t.reviewAnswer)||null}),"completed"===e.reviewStatus&&(console.log("✅ Verification completed, showing manual sync..."),h(!0),y(!0))}).on("idCheck.onError",e=>{console.error("❌ Sumsub SDK Error:",e),g("Verification system error. Please refresh the page and try again.")}).build();e.launch("#sumsub-container"),console.log("\uD83C\uDFAF Sumsub SDK launched in container")},t.onerror=()=>{g("Failed to load verification system. Please check your internet connection.")},document.body.appendChild(t)}catch(e){console.error("❌ Failed to initialize eKYC:",e),g("Unable to initialize verification system: ".concat(e.message))}};return j&&"APPROVED"!==e&&s(),()=>{t&&document.body.contains(t)&&document.body.removeChild(t)}},[j,e,k]),j)?"APPROVED"===e?(0,a.jsxs)("div",{className:"text-center space-y-6",children:[(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsx)(d.Z,{className:"h-16 w-16 text-secondary"})}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-secondary",children:"Verification Complete!"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Your identity has been successfully verified"})]}),(0,a.jsx)(n.z,{className:"w-full h-12 gradient-primary text-white border-0",onClick:()=>D.push("/dashboard"),children:"Continue to Dashboard"})]}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)(x,{showActions:!1}),b&&(0,a.jsxs)("div",{className:"bg-destructive/10 border border-destructive/20 rounded-lg p-4 flex items-start",children:[(0,a.jsx)(f.Z,{className:"h-5 w-5 text-destructive mt-0.5 mr-3 flex-shrink-0"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-destructive text-sm font-medium",children:"Verification Error"}),(0,a.jsx)("p",{className:"text-destructive text-xs mt-1",children:b})]})]}),(0,a.jsx)("div",{className:"bg-white shadow-xl rounded-2xl overflow-hidden",children:(0,a.jsx)("div",{id:"sumsub-container",style:{width:"100%",minHeight:"600px"},className:"flex items-center justify-center",children:!b&&(0,a.jsxs)("div",{className:"text-center p-8",children:[(0,a.jsx)(o.T,{size:"lg"}),(0,a.jsx)("p",{className:"text-muted-foreground mt-4",children:"Loading verification system..."})]})})}),p&&m&&"completed"===v.reviewStatus&&(0,a.jsxs)("div",{className:"text-center space-y-4",children:[(0,a.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:(0,a.jsxs)("div",{className:"flex items-start",children:[(0,a.jsx)(d.Z,{className:"h-5 w-5 text-yellow-500 mt-0.5 mr-3 flex-shrink-0"}),(0,a.jsxs)("div",{className:"text-left",children:[(0,a.jsx)("p",{className:"text-yellow-800 text-sm font-medium",children:"Verification completed successfully!"}),(0,a.jsx)("p",{className:"text-yellow-700 text-xs mt-1",children:"Click below to complete the process"})]})]})}),(0,a.jsx)(n.z,{onClick:C,disabled:s,className:"w-full gradient-primary text-white border-0",children:s?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(o.T,{className:"mr-2"}),"Syncing..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d.Z,{className:"h-4 w-4 mr-2"}),"Complete Verification"]})})]}),!1]}):(0,a.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,a.jsxs)("div",{className:"text-center space-y-2",children:[(0,a.jsx)(o.T,{}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Initializing verification system..."})]})})}var y=s(8837);function b(){let{isAuthenticated:e,ekycStatus:t,isLoading:s}=(0,i.useRequireAuth)();return s?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,a.jsx)(o.T,{size:"lg"})}):e?"APPROVED"===t?(window.location.href="/dashboard",null):(0,a.jsx)(y.default,{title:"Identity Verification",subtitle:"Complete your eKYC to access all features",children:(0,a.jsx)(p,{})}):null}}},function(e){e.O(0,[367,708,473,971,864,744],function(){return e(e.s=8538)}),_N_E=e.O()}]);