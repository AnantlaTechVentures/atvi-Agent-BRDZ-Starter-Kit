(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[937],{612:function(e,t,s){"use strict";s.d(t,{Z:function(){return i}});var r=s(5531);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let i=(0,r.Z)("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]])},1271:function(e,t,s){"use strict";s.d(t,{Z:function(){return i}});var r=s(5531);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let i=(0,r.Z)("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]])},9318:function(e,t,s){Promise.resolve().then(s.bind(s,8872))},8872:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return w}});var r=s(7437),i=s(2265),a=s(4033),n=s(3023),l=s(220),c=s(6951),d=s(1121),o=s(8063),u=s(5531);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let m=(0,u.Z)("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]),x=(0,u.Z)("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);var h=s(612),f=s(6141);function p(e){let{deviceInfo:t,loading:s,error:i}=e;return s?(0,r.jsx)("div",{className:"bg-muted/50 rounded-xl p-6",children:(0,r.jsxs)("div",{className:"animate-pulse space-y-4",children:[(0,r.jsx)("div",{className:"h-4 bg-muted rounded w-1/2 mx-auto"}),(0,r.jsx)("div",{className:"space-y-3",children:[1,2,3,4].map(e=>(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("div",{className:"h-4 w-4 bg-muted rounded"}),(0,r.jsxs)("div",{className:"space-y-1 flex-1",children:[(0,r.jsx)("div",{className:"h-3 bg-muted rounded w-1/4"}),(0,r.jsx)("div",{className:"h-3 bg-muted rounded w-1/2"})]})]},e))})]})}):i?(0,r.jsxs)("div",{className:"bg-destructive/10 rounded-xl p-6",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 text-destructive",children:[(0,r.jsx)(o.Z,{className:"h-4 w-4"}),(0,r.jsx)("p",{className:"text-sm font-medium",children:"Failed to load device information"})]}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:i})]}):(0,r.jsxs)("div",{className:"bg-muted/50 rounded-xl p-6 space-y-4",children:[(0,r.jsx)("h3",{className:"font-semibold text-center mb-4",children:"Device Information"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[(0,r.jsxs)("div",{className:"flex items-start gap-2",children:[(0,r.jsx)(m,{className:"h-4 w-4 text-muted-foreground mt-0.5 flex-shrink-0"}),(0,r.jsxs)("div",{className:"min-w-0",children:[(0,r.jsx)("p",{className:"font-medium",children:"IP Address"}),(0,r.jsx)("p",{className:"text-muted-foreground break-all",children:t.ip_address||"Unknown"})]})]}),(0,r.jsxs)("div",{className:"flex items-start gap-2",children:[(0,r.jsx)(x,{className:"h-4 w-4 text-muted-foreground mt-0.5 flex-shrink-0"}),(0,r.jsxs)("div",{className:"min-w-0",children:[(0,r.jsx)("p",{className:"font-medium",children:"Location"}),(0,r.jsx)("p",{className:"text-muted-foreground",children:t.location||"Unknown location"})]})]}),(0,r.jsxs)("div",{className:"flex items-start gap-2",children:[(0,r.jsx)(h.Z,{className:"h-4 w-4 text-muted-foreground mt-0.5 flex-shrink-0"}),(0,r.jsxs)("div",{className:"min-w-0",children:[(0,r.jsx)("p",{className:"font-medium",children:"Device"}),(0,r.jsx)("p",{className:"text-muted-foreground break-words",children:(()=>{if(t.browser&&t.os)return"".concat(t.browser," on ").concat(t.os);if(t.user_agent){let e=t.user_agent.match(/(Chrome|Firefox|Safari|Edge)\/[\d.]+/);return e?e[0]:"Unknown browser"}return"Unknown device"})()})]})]}),(0,r.jsxs)("div",{className:"flex items-start gap-2",children:[(0,r.jsx)(f.Z,{className:"h-4 w-4 text-muted-foreground mt-0.5 flex-shrink-0"}),(0,r.jsxs)("div",{className:"min-w-0",children:[(0,r.jsx)("p",{className:"font-medium",children:"Login Attempt"}),(0,r.jsx)("p",{className:"text-muted-foreground",children:(e=>{try{return new Date(e).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",timeZoneName:"short"})}catch(t){return e}})(t.timestamp)})]})]})]}),t.device_id&&(0,r.jsx)("div",{className:"pt-2 mt-4 border-t border-muted",children:(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Device ID: ",(0,r.jsx)("span",{className:"font-mono",children:t.device_id})]})})]})}var g=s(4530),v=s(9806),N=s(1271),j=s(3732);function y(){let e=(0,a.useRouter)(),t=(0,a.useSearchParams)(),{login:s}=(0,l.useAuth)(),{sdkReady:o,sdk:u,updateToken:m}=(0,c.e)(),[x,h]=(0,i.useState)("pending"),[y,b]=(0,i.useState)(null),[k,w]=(0,i.useState)(!1),[S,I]=(0,i.useState)(300),[_,Z]=(0,i.useState)(null),M=t.get("session"),E=t.get("email"),A=t.get("device_info");if((0,i.useEffect)(()=>{if(A)try{b(JSON.parse(A))}catch(e){console.error("Failed to parse device info:",e)}},[A]),(0,i.useEffect)(()=>{let t,r;if(!o||!M||"pending"!==x)return;let i=async()=>{try{var t,r,i,a;w(!0);let n=await u.auth.checkMobileLoginStatus(M),l=(null===(t=n.data)||void 0===t?void 0:t.status)||n.status,c=(null===(r=n.data)||void 0===r?void 0:r.user)||n.user,d=(null===(i=n.data)||void 0===i?void 0:i.token)||n.token;if("approved"===l){if(h("approved"),d&&c){localStorage.setItem("pending_username",E||""),c&&(localStorage.setItem("user_id",c.user_id||""),localStorage.setItem("username",c.username||""),localStorage.setItem("email",c.email||""),localStorage.setItem("phone",c.phone||""),localStorage.setItem("ekyc_status",c.ekyc_status||"PENDING"),localStorage.setItem("user",JSON.stringify(c)));let t=(null===(a=n.data)||void 0===a?void 0:a.client)||n.client;t&&localStorage.setItem("client_id",t.client_id||""),d&&localStorage.setItem("token",d),m(d),s(d,c);let r=c.ekyc_status||"PENDING";"APPROVED"===r?e.push("/dashboard"):e.push("/ekyc")}else Z("Authentication succeeded but user data is missing")}else"denied"===l?h("denied"):"expired"===l&&h("expired")}catch(e){console.error("Mobile verification polling error:",e),Z(e.message||"Failed to check login status"),h("error")}finally{w(!1)}};return t=setInterval(i,2e3),r=setTimeout(()=>{clearInterval(t),h("expired")},3e5),i(),()=>{clearInterval(t),clearTimeout(r)}},[o,M,x,u,m,s,e]),(0,i.useEffect)(()=>{if("pending"===x&&S>0){let e=setInterval(()=>{I(e=>e-1)},1e3);return()=>clearInterval(e)}},[x,S]),(0,i.useEffect)(()=>{if("denied"===x||"expired"===x||"error"===x){let t=setTimeout(()=>{e.push("/auth/login")},3e3);return()=>clearTimeout(t)}},[x,e]),!M)return e.push("/auth/login"),null;if(!o)return(0,r.jsxs)("div",{className:"text-center space-y-4",children:[(0,r.jsx)(d.T,{}),(0,r.jsx)("p",{className:"text-muted-foreground",children:"Initializing secure connection..."})]});let T=(()=>{switch(x){case"approved":return{title:"Login Approved!",subtitle:"Redirecting to your dashboard...",className:"text-secondary"};case"denied":return{title:"Login Denied",subtitle:"The login request was denied on your mobile device",className:"text-destructive"};case"expired":return{title:"Session Expired",subtitle:"The login request has timed out",className:"text-muted-foreground"};case"error":return{title:"Verification Error",subtitle:_||"An error occurred while verifying your login",className:"text-destructive"};default:return{title:"Approve login using ABSK mobile app",subtitle:"Logging in as ".concat(E),className:"text-foreground"}}})();return(0,r.jsxs)("div",{className:"space-y-8 text-center",children:[(0,r.jsx)("div",{className:"mb-8",children:(0,r.jsx)(j.ZP,{size:"lg",className:"mx-auto mb-4"})}),(0,r.jsx)("div",{className:"flex justify-center",children:(()=>{switch(x){case"approved":return(0,r.jsx)(g.Z,{className:"h-16 w-16 text-secondary"});case"denied":case"error":return(0,r.jsx)(v.Z,{className:"h-16 w-16 text-destructive"});case"expired":return(0,r.jsx)(f.Z,{className:"h-16 w-16 text-muted-foreground"});default:return(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(N.Z,{className:"h-16 w-16 text-primary"}),k&&(0,r.jsx)("div",{className:"absolute -top-1 -right-1",children:(0,r.jsx)(d.T,{size:"sm"})})]})}})()}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold ".concat(T.className),children:T.title}),(0,r.jsx)("p",{className:"text-muted-foreground",children:T.subtitle})]}),"pending"===x&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,r.jsx)(d.T,{size:"sm"}),(0,r.jsx)("span",{className:"text-sm text-muted-foreground",children:"Awaiting Mobile Confirmation"})]}),(0,r.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Session expires in ","".concat(Math.floor(S/60),":").concat((S%60).toString().padStart(2,"0"))]})]}),y&&(0,r.jsx)(p,{deviceInfo:y,loading:!1,error:null}),(0,r.jsxs)("div",{className:"space-y-3",children:["pending"===x&&(0,r.jsx)(n.z,{variant:"outline",className:"w-full",onClick:()=>e.push("/auth/login"),children:"Try Different Method"}),("denied"===x||"expired"===x||"error"===x)&&(0,r.jsx)(n.z,{className:"w-full gradient-primary text-white border-0",onClick:()=>e.push("/auth/login"),children:"Try Again"})]}),"pending"===x&&(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Check your mobile device for the login request notification"}),!1]})}var b=s(8837);function k(){return(0,r.jsx)(b.default,{title:"Mobile Verification",subtitle:"Approve login using your mobile device",children:(0,r.jsx)(y,{})})}function w(){return(0,r.jsx)(i.Suspense,{fallback:(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsx)(d.T,{size:"lg"})}),children:(0,r.jsx)(k,{})})}}},function(e){e.O(0,[367,708,473,971,864,744],function(){return e(e.s=9318)}),_N_E=e.O()}]);